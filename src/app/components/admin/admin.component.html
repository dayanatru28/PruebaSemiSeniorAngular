<div class="container">
    <!-- T√≠tulo del administrador de Tareas -->
    <div class="title-div">
        <h1>Panel de Administraci√≥n de Tareas</h1>
    </div>

    <br>

    <!-- Bot√≥n para abrir el formulario de agregar tarea -->
    <button class="add-button float-end" (click)="abrirModal()">
        Agregar Tarea +
        <i class="fas fa-plus ms-2"></i>
    </button>

    <!-- Filtro de tareas -->
    <div class="filter-container">
        <label for="filtroEstado" class="filter-label">üìå Filtro:</label>
        <select id="filtroEstado" class="form-select filter-select" [(ngModel)]="filtroEstado">
            <option value="todas">Todas</option>
            <option value="completadas">Completadas</option>
            <option value="pendientes">Pendientes</option>
        </select>
    </div>

    <!-- Tabla de Tareas -->
    <div class="table-container mt-4">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Numero</th>
                    <th>T√≠tulo</th>
                    <th>Descripci√≥n</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let task of tareasFiltradas">
                    <td>{{ task.id }}</td>
                    <td>{{ task.titulo }}</td>
                    <td>{{ task.descripcion }}</td>
                    <td class="estado-container">
                        <span [ngClass]="{ 'completado': task.completado, 'pendiente': !task.completado }">
                            {{ task.completado ? '‚úÖ Completado' : '‚ùå Pendiente' }}
                        </span>
                        
                        <!-- Switch para cambiar estado -->
                        <label class="switch" style="margin-left: 10%;">
                            <input type="checkbox" [checked]="task.completado" (change)="actualizarEstado(task)">
                            <span class="slider round"></span>
                        </label>
                    </td>                   
                    <td>
                        <!-- Boton para editar-->
                        <button class="btn btn-warning me-2" (click)="editarTarea(task)">
                            ‚úèÔ∏è Editar
                        </button>
                        <!-- Boton para eliminar-->
                        <button class="btn btn-danger" (click)="eliminarTarea(task.id)">
                            üóë Eliminar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para agregar/editar tarea -->
<div *ngIf="mostrarModal" class="modal-backdrop">
    <div class="modal">
        <div class="modal-header">
            <h2>{{ isUpdate ? 'Editar Tarea' : 'Agregar Nueva Tarea' }}</h2>
            <button (click)="cerrarModal()">‚úñ</button>
        </div>

        <div class="modal-body">
            <form [formGroup]="formTasks" (ngSubmit)="isUpdate ? actualizarTarea() : agregarTarea()">

                <div class="form-group">
                    <label for="id">C√≥digo de Tarea:</label>
                    <input id="id" type="number" formControlName="id" class="form-control" [readonly]="isUpdate"
                        required />
                    <div *ngIf="formTasks.get('id')?.invalid && formTasks.get('id')?.touched" class="error">
                        ‚ö† El c√≥digo debe ser num√©rico y obligatorio.
                    </div>
                </div>

                <div class="form-group">
                    <label for="titulo">T√≠tulo:</label>
                    <input id="titulo" type="text" formControlName="titulo" class="form-control" required />
                    <div *ngIf="formTasks.get('titulo')?.invalid && formTasks.get('titulo')?.touched" class="error">
                        ‚ö† El t√≠tulo es obligatorio
                    </div>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripci√≥n:</label>
                    <textarea id="descripcion" formControlName="descripcion" class="form-control" required></textarea>
                    <div *ngIf="formTasks.get('descripcion')?.invalid && formTasks.get('descripcion')?.touched"
                        class="error">
                        ‚ö† La descripci√≥n es obligatoria
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" formControlName="completado" (change)="actualizarCompletado($event)" />
                        Completado
                    </label>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" [disabled]="formTasks.invalid">
                        {{ isUpdate ? 'Actualizar Tarea' : 'Guardar Tarea' }}
                    </button>
                    <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>